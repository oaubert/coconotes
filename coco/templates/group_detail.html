{% extends "base.html" %}

{% load coco %}
{% load i18n %}
{% load admin_urls %}
{% load humanize %}
{% load staticfiles %}

{% block breadcrumb %}
<span class="topmenu_item"><a href="../">{% trans "Groups" %}</a></span>
<span class="topmenu_item active"><a href="#">{% trans "Group" %} {{ group.name }}</a></span>
{% endblock %}
{% block title %}{% blocktrans %}COCo platform{% endblocktrans %} - {% blocktrans %}Group{% endblocktrans %} {{ group.name }}{% endblock %}

{% block content %}
<h1 class="pagetitle highlighted">{% trans "Group" %} {{ group.name }}</h1>

<section class="group_detail_head">

  <section class="group_detail_info">
    <article class="infoblock">
      <div class="square_div_20">
        <div class="square_content">
          <img alt="" class="thumbnail_mini" src="{{ group.metadata.thumbnail_url }}">
        </div>
      </div>
      <p>{% blocktrans with name=group.metadata.creator.username|default:"admin" %}created by {{name}}{% endblocktrans %}</p>
      <p>{{ group.metadata.description|default:"<em>No description</em>" }}</p>
    </article>
  </section>

  <section class="group_detail_members infoblock">
    <h2 class="">{% trans "Members" %}</h2>

    <div class="group_detail_member_list">
      {% for u in group.user_set.all %}
      {% with username=u.username active=group.metadata.active_users %}
      {% with annotationcount=active|get_item:username %}
      <article data-annotationcount="{{annotationcount}}" class="itemblock">
        <input data-username="{{username}}" type="checkbox" checked class="activity_selector" />
        <img alt="" class="thumbnail_micro" src="{{ u.metadata.thumbnail_url }}">
        &nbsp;<span class="username group_detail_username">{{ u.get_full_name|default:u.username }}</span>
        {% if annotationcount %}&nbsp;- {% blocktrans count count=annotationcount  %}{{count}} shared note{% plural %}{{count}} shared notes{% endblocktrans %}{% endif %}
      </article>
      {% endwith %}
      {% endwith %}
      {% endfor %}
    </div>
  </section>
</section>

<section class="group_detail_activity infoblock">
  <h2>{% trans "Group activity" %}</h2>

  <div class="infoblock group_detail_annotated_videos">
    <h5>{% blocktrans %}Annotated videos{% endblocktrans %}</h5>
    <ul class="annotated_videos_summary">
    {% for vi in group.metadata.videos %}
    <li>
      <input type="checkbox" checked data-video="{{ vi.video.uuid }}" class="activity_selector" />
      <a href="{{vi.video.get_absolute_url}}">
        <img alt="" class="thumbnail_micro" src="{{vi.video.thumbnail_url}}">
        {{ vi.video.title }}
      </a>
      -
      <span>{% blocktrans count vi.annotationcount as count %}{{count}} shared note{% plural %}{{count}} shared notes{% endblocktrans %}</span>
    </li>
    {% endfor %}
    </ul>
  </div>

  <h5>{% blocktrans %}Timeline{% endblocktrans %}</h5>
  <ul class="profile_recent_activity">
      {% for a in group.metadata.annotations %}
      <li data-username="{{a.contributor.username}}" data-video="{{a.video.uuid}}">{{a.modified|naturaltime}}
      {% if a.is_updated %}
        {% blocktrans with user=a.contributor %}{{user}} modified the annotation{% endblocktrans %}
        {% else %}
        {% blocktrans with user=a.creator%}{{user}} created the annotation{% endblocktrans %}
        {% endif %}
        <a class="annotation-link" href="{{a.contextualized_link}}"><small>{{a.title_or_description|slice:":140"}}</small></a>
        {% blocktrans %}on{% endblocktrans %}
        <a href="{{a.video.get_absolute_url}}"><small>{{a.video.title_or_description}}</small></a>
      </li>
      {% empty %}
      {% blocktrans %}The group does not have much activity yet.{% endblocktrans %}
      {% endfor %}
    </ul>

</section>


{% endblock %}

{% block extrajs %}
<script type="text/javascript" src="{% static "js/jquery.min.js" %}"></script>
<script type="text/javascript">
    $(".activity_selector").on("change", function (e) {
        if (this.dataset.username) {
            $(".profile_recent_activity [data-username='" + this.dataset.username + "']").toggle(this.checked);
        } else if (this.dataset.video) {
            $(".profile_recent_activity [data-video='" + this.dataset.video + "']").toggle(this.checked);
        }
    });
</script>
{% endblock %}

